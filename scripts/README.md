# 🚀 سكريبت إصلاح إعدادات رفع الملفات

## الوصف

سكريبت Shell متقدم يقوم **بأتمتة كاملة** لعملية تعديل إعدادات PHP لرفع الملفات الكبيرة في Laravel/Filament.

## الميزات

✅ **بحث تلقائي** عن ملف php.ini الصحيح  
✅ **تعديل آلي** باستخدام sed  
✅ **نسخة احتياطية** تلقائية قبل التعديل  
✅ **تأكيد المستخدم** قبل إجراء أي تغييرات  
✅ **ألوان واضحة** في الرسائل  
✅ **تحقق من النجاح** بعد التعديل  
✅ **معالجة الأخطاء** بشكل آمن  

## التعديلات التي يجريها

| الإعداد | القيمة القديمة | القيمة الجديدة |
|---------|----------------|----------------|
| `upload_max_filesize` | 2M | **50M** |
| `post_max_size` | 8M | **64M** |
| `max_execution_time` | 30 | **120** |

## الاستخدام

### 1. تشغيل السكريبت

```bash
./scripts/fix_upload_limits.sh
```

### 2. اتبع التعليمات

- ستظهر لك الإعدادات الحالية
- سيُطلب منك التأكيد (اضغط `y`)
- سيُطلب منك إدخال كلمة مرور sudo
- سيتم التعديل تلقائياً

### 3. أعد تشغيل السيرفر

```bash
# أوقف السيرفر الحالي (Ctrl+C)
php artisan serve
```

## مثال على التشغيل

```bash
$ ./scripts/fix_upload_limits.sh

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   🔧 سكريبت إصلاح إعدادات رفع الملفات في PHP
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 الخطوة 1: تحديد موقع ملف php.ini...
✓ تم العثور على ملف php.ini: /etc/php/8.3/cli/php.ini

📊 الخطوة 2: الإعدادات الحالية...
  upload_max_filesize: 2M
  post_max_size:       8M
  max_execution_time:  30

⚙️  الإعدادات الجديدة التي سيتم تطبيقها:
  upload_max_filesize: 50M
  post_max_size:       64M
  max_execution_time:  120

⚠️  تحذير: هذا السكريبت سيقوم بتعديل ملف php.ini
   سيتم إنشاء نسخة احتياطية قبل التعديل

هل تريد المتابعة؟ (y/n): y

💾 الخطوة 3: إنشاء نسخة احتياطية...
✓ تم إنشاء نسخة احتياطية: /etc/php/8.3/cli/php.ini.backup.20251018_143022

🔧 الخطوة 4: تعديل إعدادات php.ini...
  ✓ تم تحديث upload_max_filesize = 50M
  ✓ تم تحديث post_max_size = 64M
  ✓ تم تحديث max_execution_time = 120

📁 الخطوة 5: إعداد مجلدات Laravel...
  ✓ تم إنشاء storage/app/livewire-tmp
  ✓ تم ضبط صلاحيات livewire-tmp
  ✓ تم ضبط صلاحيات public
  ✓ تم ضبط صلاحيات logs

✅ الخطوة 6: التحقق من التعديلات...
  القيم الجديدة في php.ini:
    upload_max_filesize: 50M
    post_max_size:       64M
    max_execution_time:  120

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ✨ تم تحديث الإعدادات بنجاح!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  خطوات مهمة:
   1. أوقف سيرفر Laravel الحالي (اضغط Ctrl+C)
   2. أعد تشغيل السيرفر: php artisan serve
   3. جرّب رفع الملفات الكبيرة في Filament
```

## استعادة النسخة الاحتياطية

إذا حدثت مشكلة وأردت العودة للإعدادات القديمة:

```bash
# ابحث عن ملف النسخة الاحتياطية
ls -la /etc/php/8.3/cli/php.ini.backup.*

# استعد النسخة الاحتياطية
sudo cp /etc/php/8.3/cli/php.ini.backup.TIMESTAMP /etc/php/8.3/cli/php.ini
```

## التحقق من التعديلات

بعد إعادة تشغيل السيرفر:

```bash
php -i | grep -E "(upload_max_filesize|post_max_size|max_execution_time)"
```

**النتيجة المتوقعة:**
```
upload_max_filesize => 50M => 50M
post_max_size => 64M => 64M
max_execution_time => 120 => 120
```

## متطلبات التشغيل

- ✅ نظام Linux/Unix (Ubuntu, Debian, etc.)
- ✅ PHP مثبت (PHP CLI)
- ✅ صلاحيات sudo
- ✅ bash shell

## الأمان

السكريبت آمن تماماً:
- ✅ ينشئ نسخة احتياطية قبل أي تعديل
- ✅ يطلب تأكيد المستخدم
- ✅ يتوقف عند حدوث أي خطأ (`set -e`)
- ✅ يتحقق من وجود الملفات قبل التعديل

## استكشاف الأخطاء

### المشكلة: Permission Denied

```bash
# تأكد من تشغيل السكريبت بصلاحيات التنفيذ
chmod +x scripts/fix_upload_limits.sh
```

### المشكلة: php.ini not found

```bash
# تحقق من تثبيت PHP
php --version

# ابحث عن ملف php.ini يدوياً
php --ini
```

### المشكلة: التعديلات لا تظهر

```bash
# تأكد من إعادة تشغيل السيرفر
# اضغط Ctrl+C في terminal السيرفر
php artisan serve
```

## الملفات ذات العلاقة

- `PHP_UPLOAD_FIX_GUIDE.md` - دليل تفصيلي شامل
- `QUICK_FIX.md` - دليل سريع
- `fix_upload_limits.sh` - السكريبت الرئيسي

## الدعم

إذا واجهت أي مشكلة:
1. راجع رسائل الخطأ في output السكريبت
2. تحقق من ملف النسخة الاحتياطية
3. راجع ملف `PHP_UPLOAD_FIX_GUIDE.md` للحلول اليدوية

---

**تاريخ الإنشاء:** 18 أكتوبر 2025  
**الإصدار:** 2.0 (متقدم - أتمتة كاملة)
