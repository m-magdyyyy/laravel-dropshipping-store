# 🎯 دليل استخدام السكريبتات - إصلاح رفع الملفات

## 📦 السكريبتات المتوفرة

### 1. `fix_upload_limits.sh` ⭐ (الرئيسي)
**الوظيفة:** إصلاح تلقائي كامل لإعدادات PHP

**الاستخدام:**
```bash
./scripts/fix_upload_limits.sh
```

**ماذا يفعل؟**
- ✅ يجد ملف php.ini تلقائياً
- ✅ يعرض الإعدادات الحالية
- ✅ ينشئ نسخة احتياطية
- ✅ يعدّل القيم باستخدام sed
- ✅ ينشئ مجلد livewire-tmp
- ✅ يضبط الصلاحيات
- ✅ يعرض رسالة نجاح

---

### 2. `check_upload_settings.sh` 📊 (الفحص)
**الوظيفة:** فحص الإعدادات الحالية بدون تعديل

**الاستخدام:**
```bash
./scripts/check_upload_settings.sh
```

**ماذا يفعل؟**
- 📋 يعرض جميع الإعدادات الحالية
- ✓/✗ يظهر ما إذا كانت مناسبة أم لا
- 💡 يعطي نصائح وتوصيات

---

## 🚀 سيناريو الاستخدام الكامل

### الخطوة 1: فحص الإعدادات الحالية
```bash
./scripts/check_upload_settings.sh
```

**إذا ظهرت علامات ✗ حمراء:**
```
⚠️  الإعدادات تحتاج إلى تحسين
```
انتقل للخطوة 2.

**إذا ظهرت علامات ✓ خضراء:**
```
✅ الإعدادات مثالية لرفع الملفات الكبيرة!
```
الإعدادات جيدة، لا حاجة للتعديل.

---

### الخطوة 2: تشغيل سكريبت الإصلاح
```bash
./scripts/fix_upload_limits.sh
```

**ستظهر لك شاشة ترحيبية:**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   🔧 سكريبت إصلاح إعدادات رفع الملفات في PHP
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 الخطوة 1: تحديد موقع ملف php.ini...
✓ تم العثور على ملف php.ini: /etc/php/8.3/cli/php.ini

📊 الخطوة 2: الإعدادات الحالية...
  upload_max_filesize: 2M
  post_max_size:       8M
  max_execution_time:  30

⚙️  الإعدادات الجديدة التي سيتم تطبيقها:
  upload_max_filesize: 50M
  post_max_size:       64M
  max_execution_time:  120

⚠️  تحذير: هذا السكريبت سيقوم بتعديل ملف php.ini
   سيتم إنشاء نسخة احتياطية قبل التعديل

هل تريد المتابعة؟ (y/n):
```

**اضغط `y` ثم Enter**

---

### الخطوة 3: إدخال كلمة مرور sudo
```
[sudo] password for mohmed:
```

**أدخل كلمة مرورك واضغط Enter**

---

### الخطوة 4: مشاهدة النتائج
```
💾 الخطوة 3: إنشاء نسخة احتياطية...
✓ تم إنشاء نسخة احتياطية: /etc/php/8.3/cli/php.ini.backup.20251018_143022

🔧 الخطوة 4: تعديل إعدادات php.ini...
  ✓ تم تحديث upload_max_filesize = 50M
  ✓ تم تحديث post_max_size = 64M
  ✓ تم تحديث max_execution_time = 120

📁 الخطوة 5: إعداد مجلدات Laravel...
  ✓ تم إنشاء storage/app/livewire-tmp
  ✓ تم ضبط صلاحيات livewire-tmp
  ✓ تم ضبط صلاحيات public
  ✓ تم ضبط صلاحيات logs

✅ الخطوة 6: التحقق من التعديلات...
  القيم الجديدة في php.ini:
    upload_max_filesize: 50M
    post_max_size:       64M
    max_execution_time:  120

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   ✨ تم تحديث الإعدادات بنجاح!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### الخطوة 5: إعادة تشغيل السيرفر
```bash
# في terminal السيرفر الحالي
# اضغط: Ctrl + C

# ثم شغّل السيرفر من جديد
php artisan serve
```

---

### الخطوة 6: التحقق من نجاح التعديلات
```bash
./scripts/check_upload_settings.sh
```

**يجب أن ترى:**
```
✅ الإعدادات مثالية لرفع الملفات الكبيرة!
   يمكنك الآن رفع ملفات حتى 50 ميجابايت
```

---

## 🎨 فهم الألوان في السكريبتات

| اللون | المعنى |
|-------|---------|
| 🟢 **أخضر** | نجح / جيد |
| 🟡 **أصفر** | تحذير / يحتاج انتباه |
| 🔴 **أحمر** | خطأ / منخفض |
| 🔵 **أزرق** | معلومات |
| **عريض** | عنوان / مهم |

---

## 🔄 استعادة النسخة الاحتياطية

إذا حدثت مشكلة وأردت العودة للإعدادات القديمة:

### 1. ابحث عن ملف النسخة الاحتياطية
```bash
ls -la /etc/php/8.3/cli/ | grep backup
```

**ستجد ملف مثل:**
```
php.ini.backup.20251018_143022
```

### 2. استعد النسخة الاحتياطية
```bash
sudo cp /etc/php/8.3/cli/php.ini.backup.20251018_143022 /etc/php/8.3/cli/php.ini
```

### 3. أعد تشغيل السيرفر
```bash
# Ctrl+C ثم
php artisan serve
```

---

## ❓ استكشاف الأخطاء

### المشكلة 1: `Permission denied`
```bash
# تأكد من صلاحيات التنفيذ
chmod +x scripts/*.sh
```

### المشكلة 2: `php.ini not found`
```bash
# تحقق من تثبيت PHP
php --version

# ابحث عن php.ini يدوياً
php --ini
```

### المشكلة 3: `sudo: command not found`
```bash
# في بعض الأنظمة، استخدم su
su -
# ثم شغّل السكريبت
```

### المشكلة 4: التعديلات لا تظهر
```bash
# تأكد من:
# 1. إعادة تشغيل السيرفر (مهم جداً!)
# 2. إغلاق وإعادة فتح terminal
# 3. التحقق من الملف الصحيح:
php --ini
```

### المشكلة 5: لا يزال خطأ الرفع موجوداً
```bash
# تحقق من:
# 1. هل أعدت تشغيل السيرفر؟
php artisan serve

# 2. هل الإعدادات تطبقت؟
php -i | grep upload_max_filesize

# 3. هل مجلد livewire-tmp موجود؟
ls -la storage/app/ | grep livewire
```

---

## 📋 الأوامر السريعة

```bash
# فحص الإعدادات
./scripts/check_upload_settings.sh

# إصلاح تلقائي
./scripts/fix_upload_limits.sh

# التحقق من php.ini
php --ini

# عرض القيم الحالية
php -i | grep -E "(upload_max_filesize|post_max_size|max_execution_time)"

# إعادة تشغيل السيرفر
# Ctrl+C ثم:
php artisan serve

# تشغيل Queue Worker (للصور)
php artisan queue:work
```

---

## 🎯 الخلاصة

### قبل تشغيل السكريبتات:
- ❌ upload_max_filesize: 2M
- ❌ post_max_size: 8M
- ❌ رفع الملفات الكبيرة يفشل

### بعد تشغيل السكريبتات:
- ✅ upload_max_filesize: 50M
- ✅ post_max_size: 64M
- ✅ رفع الملفات حتى 50MB ينجح
- ✅ نظام تحسين الصور يعمل
- ✅ thumbnails تُنشأ تلقائياً

---

## 📚 ملفات التوثيق الأخرى

- `README.md` - دليل السكريبتات
- `PHP_UPLOAD_FIX_GUIDE.md` - دليل شامل تفصيلي
- `QUICK_FIX.md` - حل سريع
- `CHANGES_SUMMARY.md` - ملخص التغييرات
- `IMAGE_OPTIMIZATION_README.md` - نظام تحسين الصور

---

**تاريخ الإنشاء:** 18 أكتوبر 2025  
**الحالة:** ✅ جاهز للاستخدام الفوري
